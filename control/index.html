<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>IoT Cart Manager · Control</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="../assets/css/styles.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-light bg-white border-bottom sticky-top">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold fs-3" href="../">
      <i class="fas fa-robot text-primary me-2"></i>IoT Cart Manager
    </a>
    <div class="d-flex align-items-center gap-2">
      <button id="themeBtn" class="theme-toggle">
        <i class="fas fa-moon"></i>
      </button>
      <a class="btn btn-outline-primary" href="../">
        <i class="fas fa-tachometer-alt me-1"></i>Dashboard
      </a>
      <a class="btn btn-primary active" href="./">
        <i class="fas fa-gamepad me-1"></i>Control
      </a>
      <a class="btn btn-outline-primary" href="../monitor/">
        <i class="fas fa-satellite-dish me-1"></i>Monitoreo
      </a>
    </div>
  </div>
</nav>

<div class="container py-4">
  <div class="row">
    <div class="col-lg-8 mx-auto">
      <!-- Header Mejorado -->
      <div class="text-center mb-5">
        <h1 class="display-5 fw-bold text-gradient mb-3">Control Manual</h1>
        <p class="lead text-muted fs-4">Controla tu dispositivo IoT en tiempo real</p>
      </div>

      <!-- Panel de Control Rediseñado -->
      <div class="card control-card shadow-lg border-0">
        <div class="card-body p-4">
          <div class="drive-pad-enhanced">
            <!-- Fila 1 -->
            <button class="drive-btn drive-btn-corner" data-move="forward_left">
              <i class="fas fa-arrow-up-left"></i>
            </button>
            <button class="drive-btn drive-btn-up" data-move="forward">
              <i class="fas fa-arrow-up"></i>
            </button>
            <button class="drive-btn drive-btn-corner" data-move="forward_right">
              <i class="fas fa-arrow-up-right"></i>
            </button>

            <!-- Fila 2 -->
            <button class="drive-btn drive-btn-left" data-move="rotate_left">
              <i class="fas fa-undo"></i>
            </button>
            <button class="drive-btn drive-btn-stop" data-move="stop">
              <i class="fas fa-stop"></i>
            </button>
            <button class="drive-btn drive-btn-right" data-move="rotate_right">
              <i class="fas fa-redo"></i>
            </button>

            <!-- Fila 3 -->
            <button class="drive-btn drive-btn-corner" data-move="backward_left">
              <i class="fas fa-arrow-down-left"></i>
            </button>
            <button class="drive-btn drive-btn-down" data-move="backward">
              <i class="fas fa-arrow-down"></i>
            </button>
            <button class="drive-btn drive-btn-corner" data-move="backward_right">
              <i class="fas fa-arrow-down-right"></i>
            </button>
          </div>

          <!-- Botones de Demo -->
          <div class="demo-buttons mt-4 text-center">
            <button id="btnDemoL" class="btn btn-outline-primary btn-lg me-3">
              <i class="fas fa-sync-alt me-2"></i>Giro 360° Izquierda
            </button>
            <button id="btnDemoR" class="btn btn-outline-primary btn-lg">
              <i class="fas fa-sync-alt me-2"></i>Giro 360° Derecha
            </button>
          </div>
        </div>
      </div>

      <!-- Log de Comandos Mejorado -->
      <div class="card mt-4 shadow-sm border-0">
        <div class="card-header bg-primary text-white">
          <h5 class="card-title mb-0 fs-4">
            <i class="fas fa-terminal me-2"></i>Registro de Comandos
          </h5>
        </div>
        <div class="card-body p-0">
          <div class="log-enhanced" id="log"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Footer -->
<footer class="footer mt-5 py-4 bg-light border-top">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-6">
        <p class="mb-0 fw-bold fs-5">
          <i class="fas fa-user-graduate me-2 text-primary"></i>
          Mary Jose Hernández Fernández
        </p>
        <p class="mb-0 text-muted fs-6">
          <i class="fas fa-laptop-code me-2"></i>
          Ingeniería en Sistemas Computacionales
        </p>
      </div>
      <div class="col-md-6 text-md-end">
        <a href="https://www.linkedin.com/in/mary-jose-hernández-fernández" 
           class="btn btn-outline-primary btn-lg" target="_blank">
          <i class="fab fa-linkedin me-2"></i>
          Conectar en LinkedIn
        </a>
      </div>
    </div>
  </div>
</footer>

<script type="module">
import "../assets/js/config.js";
import { sendMove, sendDemo } from "../assets/js/api.js";

const log = document.getElementById("log");

function addLog(txt, err = false) {
  const line = document.createElement("div");
  const stamp = new Date().toLocaleTimeString();
  line.className = `log-line ${err ? 'log-error' : 'log-success'}`;
  line.innerHTML = `
    <span class="log-time">[${stamp}]</span>
    <span class="log-message">${txt}</span>
    ${err ? '<i class="fas fa-exclamation-triangle ms-2"></i>' : '<i class="fas fa-check-circle ms-2"></i>'}
  `;
  log.appendChild(line);
  log.scrollTop = log.scrollHeight;
}

// Control de movimiento
document.querySelectorAll(".drive-btn").forEach(btn => {
  btn.addEventListener("click", async () => {
    const dir = btn.dataset.move;
    try {
      await sendMove(dir, 70); // Velocidad fija en 70%
      addLog(`Movimiento: "${dir}" enviado correctamente`);
    } catch(e) {
      addLog(`Error en "${dir}": ${e}`, true);
    }
  });
});

// Demos
document.getElementById("btnDemoL").onclick = async () => {
  try {
    await sendDemo("spin_left", 10);
    addLog(`Demo "spin_left" ejecutada`);
  } catch(e) {
    addLog(`Error en demo: ${e}`, true);
  }
};

document.getElementById("btnDemoR").onclick = async () => {
  try {
    await sendDemo("spin_right", 10);
    addLog(`Demo "spin_right" ejecutada`);
  } catch(e) {
    addLog(`Error en demo: ${e}`, true);
  }
};
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>